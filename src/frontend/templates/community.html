<!--
Copyright 2020 Google LLC
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    https://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    />

    <title>MoniNextER - Donations</title>

    <link rel="icon" href="static/img/favicon.png" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link rel="stylesheet" href="static/styles/cymbal.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="static/styles/platform.css" />
    <link rel="stylesheet" href="static/styles/platform/None.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .inter {
        font-family: "Inter", sans-serif;
        font-optical-sizing: auto;
      }

      html,
      body {
        font-family: "Inter", sans-serif;
        font-optical-sizing: auto;
      }
    </style>
  </head>

  <body>
    <span class="text-gray-800 font-medium hidden" id="accountId">{{
      account_id
    }}</span>
    <!-- Main Content -->
    <main class="p-3 flex">
      <!-- Top row - overview, account # -->
      <!-- Desktop Sidenav -->
      <div
        class="left-0 top-0 h-full w-64 bg-white border-r border-gray-100 flex-col hidden md:flex z-20"
      >
        <!-- Logo section -->
        <div class="p-6 pb-8">
          <a href="/home" class="flex items-center">
            <span class="ml-3 text-2xl font-bold text-gray-900">MonieNext</span>
          </a>
        </div>

        <!-- Navigation links -->
        <div class="flex-grow">
          <ul>
            <!-- Home - Active -->
            <li>
              <a
                href="/"
                class="flex items-center px-6 py-3.5 text-gray-500 hover:bg-gray-50"
              >
                <div class="flex items-center justify-center w-6 h-6">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    class="w-6 h-6"
                  >
                    <path d="M4 13h4v4h8v-4h4L12 5z" fill="currentColor" />
                  </svg>
                </div>
                <span class="ml-3 font-medium">Home</span>
              </a>
            </li>

            <!-- Transactions -->
            <li>
              <a
                href="/transactions"
                class="flex items-center px-6 py-3.5 text-gray-500 hover:bg-gray-50"
              >
                <div class="flex items-center justify-center w-6 h-6">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    class="w-6 h-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    />
                  </svg>
                </div>
                <span class="ml-3 font-medium">Transactions</span>
              </a>
            </li>

            <!-- Savings -->
            <li>
              <a
                href="/savings"
                class="flex items-center px-6 py-3.5 text-gray-500 hover:bg-gray-50"
              >
                <div class="flex items-center justify-center w-6 h-6">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    class="w-6 h-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                </div>
                <span class="ml-3 font-medium">Savings</span>
              </a>
            </li>

            <!-- donations -->
            <li>
              <a
                href="/donations"
                class="flex items-center px-6 py-3.5 text-gray-500 hover:bg-gray-50"
              >
                <div class="flex items-center justify-center w-6 h-6">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    class="w-6 h-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                    />
                  </svg>
                </div>
                <span class="ml-3 font-medium">Donations</span>
              </a>
            </li>

            <li class="relative">
              <!-- Blue indicator bar -->
              <div
                class="absolute left-0 top-0 bottom-0 w-1 bg-blue-600 rounded-r-md"
              ></div>
              <a
                href="/community"
                class="flex items-center px-6 py-3.5 bg-blue-50 text-blue-600"
              >
                <div class="flex items-center justify-center w-6 h-6">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    class="w-6 h-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2"
                    />
                  </svg>
                </div>
                <span class="ml-3 font-medium">Community</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Logout at bottom -->
        <div class="p-6 border-t border-gray-100">
          <a
            href="/logout"
            class="flex items-center text-gray-500 hover:text-gray-700"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
              />
            </svg>
            <span class="ml-3 font-medium">Logout</span>
          </a>
        </div>
      </div>

      <!-- Mobile Bottom Navigation Bar -->
      <div
        class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 md:hidden z-20"
      >
        <div class="flex justify-between items-center">
          <!-- Home -->
          <a
            href="/home"
            class="flex flex-col items-center justify-center text-gray-500"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path d="M4 13h4v4h8v-4h4L12 5z" />
            </svg>
            <span class="text-xs mt-1">Home</span>
          </a>

          <!-- Transactions -->
          <a
            href="/transactions"
            class="flex flex-col items-center justify-center text-gray-500"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
              />
            </svg>
            <span class="text-xs mt-1">Transactions</span>
          </a>

          <!-- Savings -->
          <a
            href="/savings"
            class="flex flex-col items-center justify-center text-gray-500"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span class="text-xs mt-1">Savings</span>
          </a>

          <!-- Donations -->
          <a
            href="/donations"
            class="flex flex-col items-center justify-center text-gray-500"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
              />
            </svg>
            <span class="text-xs mt-1">Donations</span>
          </a>

          <!-- More menu (for Community & Logout) -->
          <button
            class="flex flex-col items-center justify-center text-gray-500 focus:outline-none"
            id="mobileMoreBtn"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
            <span class="text-xs mt-1">More</span>
          </button>
        </div>
      </div>

      <div
        id="mobileMoreMenu"
        class="fixed bottom-16 right-4 bg-white rounded-lg shadow-lg p-4 hidden z-30"
      >
        <ul class="space-y-3">
          <li>
            <a href="/community" class="flex items-center text-blue-600">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                class="w-5 h-5 mr-3"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2"
                />
              </svg>
              Community
            </a>
          </li>
          <li>
            <a href="/logout" class="flex items-center text-gray-700">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                class="w-5 h-5 mr-3"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                />
              </svg>
              Logout
            </a>
          </li>
        </ul>
      </div>

      <div
        class="flex flex-col gap-6 align-items-start p-2 md:ml-4 w-full mt-8"
      >
        <!-- Initial Loader -->
        <div
          id="loadingContainer"
          class="w-full flex justify-center items-center py-16"
        >
          <div class="text-center">
            <div
              class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto"
            ></div>
            <p class="mt-4 text-gray-600">Loading your community savings...</p>
            <div class="w-64 h-2 bg-gray-200 rounded-full mt-4 overflow-hidden">
              <div
                id="progressBar"
                class="h-full bg-blue-600 rounded-full"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>

        <!-- Main Content (initially hidden) -->
        <div id="mainContent" class="w-full hidden pb-20">
          <!-- Summary Card -->
          <div
            class="w-full bg-white rounded-xl shadow-md overflow-hidden mb-6"
          >
            <div class="p-6">
              <div
                class="flex flex-col md:flex-row justify-between items-start md:items-center"
              >
                <div>
                  <h1 class="text-2xl font-bold text-gray-800 mb-1">
                    Community Savings
                  </h1>
                  <p class="text-gray-500">
                    Save together with friends, family, and colleagues
                  </p>
                </div>
                <button
                  id="createCommunityBtn"
                  class="mt-4 md:mt-0 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center transition-colors"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5 mr-2"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  New Community
                </button>
              </div>

              <div class="flex flex-wrap mt-6 -mx-2">
                <div class="w-full md:w-1/3 px-2 mb-4 md:mb-0">
                  <div class="p-4 bg-indigo-50 rounded-lg">
                    <div class="flex items-center">
                      <div class="p-3 bg-indigo-100 rounded-full mr-4">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-6 w-6 text-indigo-600"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                          />
                        </svg>
                      </div>
                      <div>
                        <p class="text-sm text-indigo-600 font-medium">
                          Total Savings
                        </p>
                        <h3
                          id="totalCommunitySavings"
                          class="text-2xl font-bold text-gray-800"
                        >
                          ₦0.00
                        </h3>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="w-full md:w-1/3 px-2 mb-4 md:mb-0">
                  <div class="p-4 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                      <div class="p-3 bg-green-100 rounded-full mr-4">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-6 w-6 text-green-600"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                      </div>
                      <div>
                        <p class="text-sm text-green-600 font-medium">
                          Last Activity
                        </p>
                        <h3
                          id="lastActivity"
                          class="text-2xl font-bold text-gray-800"
                        >
                          N/A
                        </h3>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="w-full md:w-1/3 px-2">
                  <div class="p-4 bg-purple-50 rounded-lg">
                    <div class="flex items-center">
                      <div class="p-3 bg-purple-100 rounded-full mr-4">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-6 w-6 text-purple-600"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                          />
                        </svg>
                      </div>
                      <div>
                        <p class="text-sm text-purple-600 font-medium">
                          Total Communities
                        </p>
                        <h3
                          id="totalCommunitiesCount"
                          class="text-2xl font-bold text-gray-800"
                        >
                          0
                        </h3>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Communities Message (initially hidden) -->
          <div
            id="noCommunitiesMessage"
            class="w-full bg-white rounded-xl shadow-md overflow-hidden p-8 text-center hidden"
          >
            <div
              class="w-24 h-24 mx-auto bg-indigo-100 rounded-full flex items-center justify-center mb-6"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-indigo-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">
              No community savings yet
            </h3>
            <p class="text-gray-600 mb-6">
              Create your first community savings group to start saving together
              with others.
            </p>
            <button
              id="createFirstCommunityBtn"
              class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
              Create Your First Community
            </button>
          </div>

          <!-- Communities List Grid -->
          <div
            id="communitiesListContainer"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
          ></div>
        </div>

        <!-- Create Community Modal -->
        <div
          class="modal fade"
          id="createCommunityModal"
          tabindex="-1"
          role="dialog"
          aria-hidden="true"
        >
          <div
            class="modal-dialog modal-dialog-centered modal-lg"
            role="document"
          >
            <div class="modal-content rounded-lg shadow-lg border-0">
              <div class="modal-header border-bottom-0">
                <h5 class="modal-title font-semibold text-gray-800">
                  Create New Community Savings
                </h5>
                <button
                  type="button"
                  class="close text-gray-500"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="createCommunityForm">
                  <div class="form-group mb-4">
                    <label
                      for="communityName"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Community Name</label
                    >
                    <input
                      type="text"
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="communityName"
                      placeholder="e.g. Family Vacation Fund, Office Christmas Party"
                      required
                    />
                    <div class="invalid-feedback">
                      Please provide a name for your community savings.
                    </div>
                  </div>

                  <div class="form-group mb-4">
                    <label
                      for="communityDescription"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Description</label
                    >
                    <textarea
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="communityDescription"
                      rows="3"
                      placeholder="What's this community savings for?"
                    ></textarea>
                  </div>

                  <div class="form-group mb-4">
                    <label
                      for="communityRules"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Rules (Optional)</label
                    >
                    <textarea
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="communityRules"
                      rows="3"
                      placeholder="Any rules or guidelines for community members..."
                    ></textarea>
                  </div>

                  <div class="form-group mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >Visibility</label
                    >
                    <div class="flex items-center">
                      <input
                        type="checkbox"
                        id="isPublic"
                        class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                        checked
                      />
                      <label
                        for="isPublic"
                        class="ml-2 block text-sm text-gray-700"
                      >
                        Make this community public
                      </label>
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                      Public communities are visible to everyone and can be
                      joined by invitation.
                    </p>
                  </div>

                  <div class="form-group mb-4">
                    <label
                      for="initialAmount"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Initial Contribution (Optional)</label
                    >
                    <div class="relative">
                      <div
                        class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                      >
                        <span class="text-gray-600">₦</span>
                      </div>
                      <input
                        type="number"
                        class="form-control pl-8 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                        id="initialAmount"
                        placeholder="0.00"
                        min="0"
                        step="0.01"
                      />
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer border-top-0">
                <button
                  type="button"
                  class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                  data-dismiss="modal"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  id="saveNewCommunityBtn"
                  class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  Create Community
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- View Community Details Modal -->
        <div
          class="modal fade"
          id="viewCommunityModal"
          tabindex="-1"
          role="dialog"
          aria-hidden="true"
        >
          <div
            class="modal-dialog modal-dialog-centered modal-xl"
            role="document"
          >
            <div class="modal-content rounded-lg shadow-lg border-0">
              <div class="modal-header bg-indigo-50 border-bottom-0">
                <h5
                  class="modal-title font-semibold text-gray-800"
                  id="viewCommunityTitle"
                >
                  Community Savings Details
                </h5>
                <button
                  type="button"
                  class="close text-gray-500"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <!-- Community Overview -->
                <div class="bg-indigo-50 rounded-lg p-4 mb-4">
                  <div class="flex flex-col md:flex-row justify-between">
                    <div class="mb-4 md:mb-0">
                      <p class="text-sm text-gray-500">Current Balance</p>
                      <h2
                        id="viewCommunityBalance"
                        class="text-3xl font-bold text-gray-800"
                      >
                        ₦0.00
                      </h2>
                    </div>
                    <div class="mb-4 md:mb-0">
                      <p class="text-sm text-gray-500">Created On</p>
                      <h3
                        id="viewCommunityCreatedDate"
                        class="text-lg font-semibold text-gray-800"
                      >
                        -
                      </h3>
                    </div>
                    <div class="mb-4 md:mb-0">
                      <p class="text-sm text-gray-500">Members</p>
                      <h3
                        id="viewCommunityMemberCount"
                        class="text-lg font-semibold text-gray-800"
                      >
                        0
                      </h3>
                    </div>
                    <div>
                      <p class="text-sm text-gray-500">Visibility</p>
                      <h3
                        id="viewCommunityVisibility"
                        class="text-lg font-semibold text-gray-800"
                      >
                        -
                      </h3>
                    </div>
                  </div>
                </div>

                <!-- Tabs for Details/Members/Transactions -->
                <ul class="flex flex-wrap border-b border-gray-200 mb-4">
                  <li class="mr-2">
                    <a
                      href="#"
                      class="community-tab-link inline-block py-2 px-4 text-sm font-medium text-center text-blue-600 rounded-t-lg border-b-2 border-blue-600 active"
                      data-tab="details"
                      >Details</a
                    >
                  </li>
                  <li class="mr-2">
                    <a
                      href="#"
                      class="community-tab-link inline-block py-2 px-4 text-sm font-medium text-center text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg border-b-2 border-transparent"
                      data-tab="members"
                      >Members</a
                    >
                  </li>
                  <li class="mr-2">
                    <a
                      href="#"
                      class="community-tab-link inline-block py-2 px-4 text-sm font-medium text-center text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg border-b-2 border-transparent"
                      data-tab="transactions"
                      >Transactions</a
                    >
                  </li>
                  <li class="mr-2">
                    <a
                      href="#"
                      class="community-tab-link inline-block py-2 px-4 text-sm font-medium text-center text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg border-b-2 border-transparent"
                      data-tab="topSavers"
                      >Top Savers</a
                    >
                  </li>
                </ul>

                <!-- Tab Contents -->
                <div id="communityTabContents">
                  <!-- Details Tab -->
                  <div id="details-tab" class="community-tab-content">
                    <div class="mb-6">
                      <h4 class="text-lg font-semibold text-gray-800 mb-2">
                        Description
                      </h4>
                      <p
                        id="viewCommunityDescription"
                        class="text-gray-600 bg-gray-50 p-4 rounded-lg"
                      >
                        No description provided
                      </p>
                    </div>

                    <div class="mb-6">
                      <h4 class="text-lg font-semibold text-gray-800 mb-2">
                        Rules
                      </h4>
                      <p
                        id="viewCommunityRules"
                        class="text-gray-600 bg-gray-50 p-4 rounded-lg"
                      >
                        No rules specified
                      </p>
                    </div>
                  </div>

                  <!-- Members Tab -->
                  <div id="members-tab" class="community-tab-content hidden">
                    <div class="mb-4 flex justify-between items-center">
                      <h4 class="text-lg font-semibold text-gray-800">
                        Community Members
                      </h4>
                      <button
                        id="addMemberBtn"
                        class="px-3 py-1.5 bg-indigo-100 text-indigo-600 rounded-lg hover:bg-indigo-200 text-sm font-medium transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-4 w-4 inline mr-1"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"
                          />
                        </svg>
                        Add Member
                      </button>
                    </div>

                    <div
                      id="noMembersMessage"
                      class="text-center py-8 bg-gray-50 rounded-lg hidden"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-12 w-12 mx-auto text-gray-400 mb-3"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                        />
                      </svg>
                      <p class="text-gray-600">
                        No members in this community yet.
                      </p>
                    </div>

                    <div
                      id="membersContainer"
                      class="grid grid-cols-1 md:grid-cols-2 gap-4"
                    >
                      <!-- Members will be dynamically added here -->
                    </div>
                  </div>

                  <!-- Transactions Tab -->
                  <div
                    id="transactions-tab"
                    class="community-tab-content hidden"
                  >
                    <div
                      id="noTransactionsMessage"
                      class="text-center py-8 bg-gray-50 rounded-lg hidden"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-12 w-12 mx-auto text-gray-400 mb-3"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                        />
                      </svg>
                      <p class="text-gray-600">
                        No transactions in this community yet.
                      </p>
                    </div>
                    <div
                      id="transactionsContainer"
                      class="max-h-80 overflow-y-auto"
                    >
                      <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                          <tr>
                            <th
                              scope="col"
                              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                            >
                              Date
                            </th>
                            <th
                              scope="col"
                              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                            >
                              Type
                            </th>
                            <th
                              scope="col"
                              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                            >
                              Member
                            </th>
                            <th
                              scope="col"
                              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                            >
                              Description
                            </th>
                            <th
                              scope="col"
                              class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                            >
                              Amount
                            </th>
                            <th
                              scope="col"
                              class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                            >
                              Balance
                            </th>
                          </tr>
                        </thead>
                        <tbody
                          id="transactionsTableBody"
                          class="bg-white divide-y divide-gray-200"
                        >
                          <!-- Transactions will be dynamically added here -->
                        </tbody>
                      </table>
                    </div>
                  </div>

                  <!-- Top Savers Tab -->
                  <div id="topSavers-tab" class="community-tab-content hidden">
                    <div
                      id="noSaversMessage"
                      class="text-center py-8 bg-gray-50 rounded-lg hidden"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-12 w-12 mx-auto text-gray-400 mb-3"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                        />
                      </svg>
                      <p class="text-gray-600">
                        No contributions yet to show top savers.
                      </p>
                    </div>
                    <div id="topSaversContainer" class="bg-white">
                      <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">
                          Top Contributors
                        </h4>
                        <div id="topSaversList" class="space-y-4">
                          <!-- Top savers will be dynamically added here -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer justify-between">
                <div>
                  <button
                    id="withdrawCommunityBtn"
                    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5 inline mr-1"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    Withdraw
                  </button>
                </div>
                <div>
                  <button
                    type="button"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors mr-2"
                    data-dismiss="modal"
                  >
                    Close
                  </button>
                  <button
                    id="fundCommunityBtn"
                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5 inline mr-1"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    Contribute
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Fund Community Modal -->
        <div
          class="modal fade"
          id="fundCommunityModal"
          tabindex="-1"
          role="dialog"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content rounded-lg shadow-lg border-0">
              <div class="modal-header bg-green-50 border-bottom-0">
                <h5
                  class="modal-title font-semibold text-gray-800"
                  id="fundCommunityTitle"
                >
                  Contribute to Community
                </h5>
                <button
                  type="button"
                  class="close text-gray-500"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="fundCommunityForm">
                  <input type="hidden" id="fundCommunityWalletId" />
                  <div class="form-group mb-4">
                    <label
                      for="fundAmount"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Contribution Amount</label
                    >
                    <div class="relative">
                      <div
                        class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                      >
                        <span class="text-gray-600">₦</span>
                      </div>
                      <input
                        type="number"
                        class="form-control pl-8 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                        id="fundAmount"
                        placeholder="0.00"
                        min="0.01"
                        step="0.01"
                        required
                      />
                      <div class="invalid-feedback">
                        Please enter a valid amount greater than 0.
                      </div>
                    </div>
                  </div>
                  <div class="form-group mb-4">
                    <label
                      for="contributorName"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Your Name</label
                    >
                    <input
                      type="text"
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="contributorName"
                      placeholder="Enter your name"
                      required
                    />
                    <div class="invalid-feedback">
                      Please provide your name.
                    </div>
                  </div>
                  <div class="form-group mb-4">
                    <label
                      for="contributionNote"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Note (Optional)</label
                    >
                    <textarea
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="contributionNote"
                      rows="2"
                      placeholder="Any notes about this contribution..."
                    ></textarea>
                  </div>
                </form>
              </div>
              <div class="modal-footer border-top-0">
                <button
                  type="button"
                  class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                  data-dismiss="modal"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  id="confirmFundBtn"
                  class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                >
                  Contribute Now
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Withdraw Community Modal -->
        <div
          class="modal fade"
          id="withdrawCommunityModal"
          tabindex="-1"
          role="dialog"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content rounded-lg shadow-lg border-0">
              <div class="modal-header bg-red-50 border-bottom-0">
                <h5
                  class="modal-title font-semibold text-gray-800"
                  id="withdrawCommunityTitle"
                >
                  Withdraw from Community
                </h5>
                <button
                  type="button"
                  class="close text-gray-500"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="withdrawCommunityForm">
                  <input type="hidden" id="withdrawCommunityWalletId" />
                  <div class="form-group mb-4">
                    <label
                      for="withdrawAmount"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Amount to Withdraw</label
                    >
                    <div class="relative">
                      <div
                        class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                      >
                        <span class="text-gray-600">₦</span>
                      </div>
                      <input
                        type="number"
                        class="form-control pl-8 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                        id="withdrawAmount"
                        placeholder="0.00"
                        min="0.01"
                        step="0.01"
                        required
                      />
                      <div class="invalid-feedback">
                        Please enter a valid amount greater than 0.
                      </div>
                    </div>
                  </div>
                  <div class="form-group mb-4">
                    <label
                      for="withdrawerName"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Your Name</label
                    >
                    <input
                      type="text"
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="withdrawerName"
                      placeholder="Enter your name"
                      required
                    />
                    <div class="invalid-feedback">
                      Please provide your name.
                    </div>
                  </div>
                  <div class="form-group mb-4">
                    <label
                      for="withdrawalReason"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Reason for Withdrawal</label
                    >
                    <textarea
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="withdrawalReason"
                      rows="2"
                      placeholder="Reason for this withdrawal..."
                      required
                    ></textarea>
                    <div class="invalid-feedback">
                      Please provide a reason for the withdrawal.
                    </div>
                  </div>
                  <div
                    class="bg-yellow-50 p-3 rounded-lg text-sm text-yellow-800 mt-3"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5 inline mr-1 text-yellow-600"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    Available balance:
                    <span id="availableBalance" class="font-semibold"
                      >₦0.00</span
                    >
                  </div>
                </form>
              </div>
              <div class="modal-footer border-top-0">
                <button
                  type="button"
                  class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                  data-dismiss="modal"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  id="confirmWithdrawBtn"
                  class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                >
                  Withdraw Funds
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Add Member Modal -->
        <div
          class="modal fade"
          id="addMemberModal"
          tabindex="-1"
          role="dialog"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content rounded-lg shadow-lg border-0">
              <div class="modal-header bg-indigo-50 border-bottom-0">
                <h5
                  class="modal-title font-semibold text-gray-800"
                  id="addMemberTitle"
                >
                  Add New Member
                </h5>
                <button
                  type="button"
                  class="close text-gray-500"
                  data-dismiss="modal"
                  aria-label="Close"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="addMemberForm">
                  <input type="hidden" id="memberCommunityWalletId" />
                  <div class="form-group mb-4">
                    <label
                      for="memberName"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Member Name</label
                    >
                    <input
                      type="text"
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="memberName"
                      placeholder="Enter member's name"
                      required
                    />
                    <div class="invalid-feedback">
                      Please provide the member's name.
                    </div>
                  </div>
                  <div class="form-group mb-4">
                    <label
                      for="memberEmail"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Email (Optional)</label
                    >
                    <input
                      type="email"
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="memberEmail"
                      placeholder="Enter member's email"
                    />
                  </div>
                  <div class="form-group mb-4">
                    <label
                      for="memberPhone"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Phone (Optional)</label
                    >
                    <input
                      type="tel"
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="memberPhone"
                      placeholder="Enter member's phone number"
                    />
                  </div>
                  <div class="form-group mb-4">
                    <label
                      for="memberRole"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Role</label
                    >
                    <select
                      class="form-control bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                      id="memberRole"
                    >
                      <option value="member">Member</option>
                      <option value="admin">Admin</option>
                      <option value="treasurer">Treasurer</option>
                    </select>
                  </div>
                </form>
              </div>
              <div class="modal-footer border-top-0">
                <button
                  type="button"
                  class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                  data-dismiss="modal"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  id="saveMemberBtn"
                  class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                >
                  Add Member
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Notification Toast -->
        <div
          id="notificationToast"
          class="fixed top-4 right-4 z-50 max-w-xs bg-white rounded-lg shadow-lg p-4 transform transition-transform duration-300 translate-y-[-100px] opacity-0"
        >
          <div class="flex items-center">
            <div
              id="notificationIcon"
              class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center mr-3"
            ></div>
            <div>
              <h4
                id="notificationTitle"
                class="text-sm font-semibold text-gray-800"
              ></h4>
              <p
                id="notificationMessage"
                class="text-xs text-gray-600 mt-1"
              ></p>
            </div>
          </div>
        </div>
      </div>
      <script>
document.addEventListener('DOMContentLoaded', function() {
   // Initialize wallet engine and services
   const accountId = 'user123'; // This would typically come from your auth system
   const communityService = new CommunityService(accountId);
   
   // DOM Elements
   const loadingContainer = document.getElementById('loadingContainer');
   const progressBar = document.getElementById('progressBar');
   const mainContent = document.getElementById('mainContent');
   const noCommunitiesMessage = document.getElementById('noCommunitiesMessage');
   const communitiesListContainer = document.getElementById('communitiesListContainer');
   const totalCommunitySavings = document.getElementById('totalCommunitySavings');
   const lastActivity = document.getElementById('lastActivity');
   const totalCommunitiesCount = document.getElementById('totalCommunitiesCount');
   const createCommunityBtn = document.getElementById('createCommunityBtn');
   const createFirstCommunityBtn = document.getElementById('createFirstCommunityBtn');
   
   // Current community wallet being viewed/modified
   let currentWallet = null;
   
   // Simulated loading sequence
   function simulateLoading() {
       let progress = 0;
       const interval = setInterval(() => {
           progress += 5;
           progressBar.style.width = `${progress}%`;
           
           if (progress >= 100) {
               clearInterval(interval);
               // After 3 seconds, load content
               setTimeout(() => {
                   loadCommunities();
               }, 500);
           }
       }, 150);
   }
   
   // Format currency
   function formatCurrency(amount) {
       return new Intl.NumberFormat('en-NG', {
           style: 'currency',
           currency: 'NGN',
           minimumFractionDigits: 2,
           maximumFractionDigits: 2
       }).format(amount).replace('NGN', '₦');
   }
   
   // Format date
   function formatDate(dateString) {
       const date = new Date(dateString);
       return date.toLocaleDateString('en-NG', {
           year: 'numeric', 
           month: 'short', 
           day: 'numeric'
       });
   }
   
   // Get relative time (e.g. "2 days ago")
   function getRelativeTime(dateString) {
       const date = new Date(dateString);
       const now = new Date();
       const diffTime = Math.abs(now - date);
       const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
       
       if (diffDays === 0) {
           return 'Today';
       } else if (diffDays === 1) {
           return 'Yesterday';
       } else if (diffDays < 7) {
           return `${diffDays} days ago`;
       } else if (diffDays < 30) {
           return `${Math.floor(diffDays / 7)} weeks ago`;
       } else {
           return formatDate(dateString);
       }
   }
   
   // Load all community wallets
   function loadCommunities() {
       try {
           const wallets = communityService.getCommunitySavingsWallets();
           const totalSavings = communityService.getTotalCommunitySavings();
           
           // Update statistics
           totalCommunitySavings.textContent = formatCurrency(totalSavings);
           totalCommunitiesCount.textContent = wallets.length;
           
           // Find most recent transaction
           let mostRecentDate = null;
           
           if (wallets.length > 0) {
               // Hide no communities message, show wallets grid
               noCommunitiesMessage.classList.add('hidden');
               communitiesListContainer.classList.remove('hidden');
               
               // Sort wallets by most recent activity
               wallets.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
               
               // If any transactions, find most recent one
               wallets.forEach(wallet => {
                   const transactions = communityService.getCommunitySavingsTransactions(wallet.id);
                   if (transactions.length > 0) {
                       const latestTx = transactions.sort((a, b) => 
                           new Date(b.timestamp) - new Date(a.timestamp))[0];
                       
                       if (!mostRecentDate || new Date(latestTx.timestamp) > new Date(mostRecentDate)) {
                           mostRecentDate = latestTx.timestamp;
                       }
                   }
               });
               
               // Display wallets
               communitiesListContainer.innerHTML = '';
               wallets.forEach(wallet => renderCommunityCard(wallet));
               
           } else {
               // No wallets, show the no communities message
               noCommunitiesMessage.classList.remove('hidden');
               communitiesListContainer.classList.add('hidden');
           }
           
           // Update most recent activity
           lastActivity.textContent = mostRecentDate ? getRelativeTime(mostRecentDate) : 'N/A';
           
           // Hide loader, show content
           loadingContainer.classList.add('hidden');
           mainContent.classList.remove('hidden');
           
       } catch (error) {
           console.error('Error loading communities:', error);
           showNotification(false, 'Error', 'Failed to load your community savings. Please try again.');
           
           // Still hide loader and show content area
           loadingContainer.classList.add('hidden');
           mainContent.classList.remove('hidden');
       }
   }
   
   // Render a single community card
   function renderCommunityCard(wallet) {
       const transactions = communityService.getCommunitySavingsTransactions(wallet.id);
       let lastTxDate = 'No activity';
       
       if (transactions.length > 0) {
           const latestTx = transactions.sort((a, b) => 
               new Date(b.timestamp) - new Date(a.timestamp))[0];
           lastTxDate = getRelativeTime(latestTx.timestamp);
       }
       
       // Member count
       const memberCount = wallet.metadata && wallet.metadata.members ? wallet.metadata.members.length : 0;
       
       // Is public?
       const isPublic = wallet.metadata && wallet.metadata.publicInfo && wallet.metadata.publicInfo.isPublic;
       
       const cardHtml = `
           <div class="bg-white rounded-xl shadow-md overflow-hidden transition-all hover:shadow-lg" data-wallet-id="${wallet.id}">
               <div class="p-6">
                   <div class="flex justify-between items-start">
                       <div class="p-3 bg-indigo-100 rounded-full">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                           </svg>
                       </div>
                       <div class="flex space-x-2">
                           <div class="bg-indigo-50 px-3 py-1 rounded-full text-xs font-medium text-indigo-600">
                               Community
                           </div>
                           <div class="bg-${isPublic ? 'green' : 'gray'}-50 px-3 py-1 rounded-full text-xs font-medium text-${isPublic ? 'green' : 'gray'}-600">
                               ${isPublic ? 'Public' : 'Private'}
                           </div>
                       </div>
                   </div>
                   <h3 class="mt-4 text-xl font-semibold text-gray-800">${wallet.name}</h3>
                   <div class="mt-1 text-sm text-gray-500">Created ${formatDate(wallet.createdAt)}</div>
                   <div class="mt-4">
                       <div class="text-gray-500 text-sm">Current Balance</div>
                       <div class="text-2xl font-bold text-gray-800">${formatCurrency(wallet.balance)}</div>
                   </div>
                   <div class="mt-4 flex justify-between items-center">
                       <div class="text-sm text-gray-500 flex items-center">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                           </svg>
                           ${memberCount} members
                       </div>
                       <button class="view-community-btn px-3 py-1 bg-indigo-100 text-indigo-600 rounded-lg hover:bg-indigo-200 text-sm font-medium transition-colors">
                           View Details
                       </button>
                   </div>
               </div>
           </div>
       `;
       
       const tempDiv = document.createElement('div');
       tempDiv.innerHTML = cardHtml;
       const card = tempDiv.firstElementChild;
       
       // Add click event for the entire card
       card.addEventListener('click', () => viewCommunityDetails(wallet.id));
       
       // Also add click event for just the button (to be explicit)
       card.querySelector('.view-community-btn').addEventListener('click', (e) => {
           e.stopPropagation(); // Prevent double triggering through card click
           viewCommunityDetails(wallet.id);
       });
       
       communitiesListContainer.appendChild(card);
   }
   
   // View community details
   function viewCommunityDetails(walletId) {
       try {
           currentWallet = communityService.walletEngine.getWallet(walletId);
           
           if (!currentWallet) {
               showNotification(false, 'Error', 'Community wallet not found');
               return;
           }
           
           // Set modal title and data
           document.getElementById('viewCommunityTitle').textContent = currentWallet.name;
           document.getElementById('viewCommunityBalance').textContent = formatCurrency(currentWallet.balance);
           document.getElementById('viewCommunityCreatedDate').textContent = formatDate(currentWallet.createdAt);
           
           // Set visibility
           const isPublic = currentWallet.metadata && 
                            currentWallet.metadata.publicInfo && 
                            currentWallet.metadata.publicInfo.isPublic;
           document.getElementById('viewCommunityVisibility').textContent = isPublic ? 'Public' : 'Private';
           
           // Set member count
           const memberCount = currentWallet.metadata && 
                              currentWallet.metadata.members ? 
                              currentWallet.metadata.members.length : 0;
           document.getElementById('viewCommunityMemberCount').textContent = memberCount;
           
           // Set description and rules
           const description = currentWallet.metadata && 
                              currentWallet.metadata.publicInfo && 
                              currentWallet.metadata.publicInfo.description ?
                              currentWallet.metadata.publicInfo.description : 'No description provided';
           document.getElementById('viewCommunityDescription').textContent = description;
           
           const rules = currentWallet.metadata && 
                        currentWallet.metadata.publicInfo && 
                        currentWallet.metadata.publicInfo.rules ?
                        currentWallet.metadata.publicInfo.rules : 'No rules specified';
           document.getElementById('viewCommunityRules').textContent = rules;
           
           // Show the details tab by default
           switchTab('details');
           
           // Populate members tab
           populateMembersTab(currentWallet);
           
           // Populate transactions tab
           populateTransactionsTab(currentWallet);
           
           // Populate top savers tab
           populateTopSaversTab(currentWallet);
           
           // Show the modal
           $('#viewCommunityModal').modal('show');
           
       } catch (error) {
           console.error('Error viewing community details:', error);
           showNotification(false, 'Error', 'Failed to load community details. Please try again.');
       }
   }
   
   // Switch tabs in community modal
   function switchTab(tabName) {
       // Hide all tab contents
       document.querySelectorAll('.community-tab-content').forEach(tab => {
           tab.classList.add('hidden');
       });
       
       // Show the selected tab content
       document.getElementById(`${tabName}-tab`).classList.remove('hidden');
       
       // Update active tab link
       document.querySelectorAll('.community-tab-link').forEach(link => {
           link.classList.remove('text-blue-600', 'border-blue-600', 'active');
           link.classList.add('text-gray-500', 'border-transparent');
       });
       
       // Set the clicked tab as active
       document.querySelector(`.community-tab-link[data-tab="${tabName}"]`).classList.remove('text-gray-500', 'border-transparent');
       document.querySelector(`.community-tab-link[data-tab="${tabName}"]`).classList.add('text-blue-600', 'border-blue-600', 'active');
   }
   
   // Populate members tab
   function populateMembersTab(wallet) {
       const membersContainer = document.getElementById('membersContainer');
       const noMembersMessage = document.getElementById('noMembersMessage');
       
       // Clear previous content
       membersContainer.innerHTML = '';
       
       // Get members
       const members = wallet.metadata && wallet.metadata.members ? wallet.metadata.members : [];
       
       if (members.length === 0) {
           noMembersMessage.classList.remove('hidden');
           membersContainer.classList.add('hidden');
           return;
       }
       
       noMembersMessage.classList.add('hidden');
       membersContainer.classList.remove('hidden');
       
       // Sort members by joined date (newest first)
       members.sort((a, b) => new Date(b.joinedAt) - new Date(a.joinedAt));
       
       // Add members to the container
       members.forEach(member => {
           const memberCard = document.createElement('div');
           memberCard.className = 'bg-white border border-gray-200 rounded-lg p-4 flex items-start';
           
           const roleColor = getRoleColor(member.role);
           
           memberCard.innerHTML = `
               <div class="p-2 bg-${roleColor}-100 rounded-full mr-3">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-${roleColor}-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                   </svg>
               </div>
               <div class="flex-grow">
                   <div class="flex justify-between items-start">
                       <h4 class="text-base font-semibold text-gray-800">${member.name}</h4>
                       <span class="text-xs px-2 py-1 bg-${roleColor}-50 text-${roleColor}-600 rounded-full">${formatRole(member.role)}</span>
                   </div>
                   ${member.email ? `<p class="text-sm text-gray-500 mt-1">${member.email}</p>` : ''}
                   ${member.phone ? `<p class="text-sm text-gray-500">${member.phone}</p>` : ''}
                   <p class="text-xs text-gray-400 mt-2">Joined ${formatDate(member.joinedAt)}</p>
               </div>
           `;
           
           membersContainer.appendChild(memberCard);
       });
   }
   
   // Get role color
   function getRoleColor(role) {
       switch (role) {
           case 'admin': return 'indigo';
           case 'treasurer': return 'amber';
           default: return 'blue';
       }
   }
   
   // Format role for display
   function formatRole(role) {
       if (!role) return 'Member';
       
       return role.charAt(0).toUpperCase() + role.slice(1);
   }
   
   // Populate transactions tab
   function populateTransactionsTab(wallet) {
       try {
           const transactions = communityService.getCommunitySavingsTransactions(wallet.id);
           
           const transactionsContainer = document.getElementById('transactionsContainer');
           const noTransactionsMessage = document.getElementById('noTransactionsMessage');
           const tableBody = document.getElementById('transactionsTableBody');
           
           // Clear previous content
           tableBody.innerHTML = '';
           
           if (transactions.length === 0) {
               noTransactionsMessage.classList.remove('hidden');
               transactionsContainer.classList.add('hidden');
               return;
           }
           
           noTransactionsMessage.classList.add('hidden');
           transactionsContainer.classList.remove('hidden');
           
           // Sort transactions by timestamp (newest first)
           transactions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
           
           // Add transactions to the table
           transactions.forEach(tx => {
               const row = document.createElement('tr');
               
               // Format the amount with the appropriate color and sign
               const amountClass = tx.type === 'credit' ? 'text-green-600' : 'text-red-600';
               const amountSign = tx.type === 'credit' ? '+' : '-';
               
               // Get contributor info if available
               let contributorName = '-';
               if (tx.type === 'credit' && wallet.metadata && wallet.metadata.contributions) {
                   const contribution = wallet.metadata.contributions.find(c => c.timestamp === tx.timestamp);
                   if (contribution) {
                       contributorName = contribution.name || '-';
                   }
               } else if (tx.type === 'debit' && wallet.metadata && wallet.metadata.withdrawals) {
                   const withdrawal = wallet.metadata.withdrawals.find(w => w.timestamp === tx.timestamp);
                   if (withdrawal) {
                       contributorName = withdrawal.name || '-';
                   }
               }
               
               row.innerHTML = `
                   <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                       ${formatDate(tx.timestamp)}
                   </td>
                   <td class="px-6 py-4 whitespace-nowrap">
                       <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${tx.type === 'credit' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                           ${tx.type === 'credit' ? 'Contribution' : 'Withdrawal'}
                       </span>
                   </td>
                   <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-medium">
                       ${contributorName}
                   </td>
                   <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                       ${tx.description}
                   </td>
                   <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-right ${amountClass}">
                       ${amountSign}${formatCurrency(tx.amount)}
                   </td>
                   <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium">
                       ${formatCurrency(tx.balance)}
                   </td>
               `;
               
               tableBody.appendChild(row);
           });
           
       } catch (error) {
           console.error('Error loading transactions:', error);
           showNotification(false, 'Error', 'Failed to load transactions. Please try again.');
       }
   }
   
   // Populate top savers tab
   function populateTopSaversTab(wallet) {
       const topSaversContainer = document.getElementById('topSaversContainer');
       const noSaversMessage = document.getElementById('noSaversMessage');
       const topSaversList = document.getElementById('topSaversList');
       
       // Clear previous content
       topSaversList.innerHTML = '';
       
       // Get contributions
       const contributions = wallet.metadata && wallet.metadata.contributions ? wallet.metadata.contributions : [];
       
       if (contributions.length === 0) {
           noSaversMessage.classList.remove('hidden');
           topSaversContainer.classList.add('hidden');
           return;
       }
       
       noSaversMessage.classList.add('hidden');
       topSaversContainer.classList.remove('hidden');
       
       // Calculate total contribution per person
       const contributorsMap = new Map();
       
       contributions.forEach(contribution => {
           const name = contribution.name || 'Anonymous';
           const currentTotal = contributorsMap.get(name) || 0;
           contributorsMap.set(name, currentTotal + contribution.amount);
       });
       
       // Convert to array and sort by amount (largest first)
       const topContributors = Array.from(contributorsMap.entries())
           .map(([name, amount]) => ({ name, amount }))
           .sort((a, b) => b.amount - a.amount);
       
       // Calculate total contributions for percentage
       const totalContributions = topContributors.reduce((sum, c) => sum + c.amount, 0);
       
       // Add top savers to the list
       topContributors.forEach((contributor, index) => {
           const percentage = totalContributions > 0 ? (contributor.amount / totalContributions) * 100 : 0;
           const isTopThree = index < 3;
           
           const saverItem = document.createElement('div');
           saverItem.className = 'bg-white border border-gray-200 rounded-lg p-4';
           
           saverItem.innerHTML = `
               <div class="flex items-center justify-between mb-2">
                   <div class="flex items-center">
                       ${isTopThree ? 
                           `<div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-700 font-bold mr-3">${index + 1}</div>` :
                           `<div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-700 font-medium mr-3">${index + 1}</div>`
                       }
                       <h4 class="text-base font-semibold text-gray-800">${contributor.name}</h4>
                   </div>
                   <span class="text-lg font-bold text-gray-800">${formatCurrency(contributor.amount)}</span>
               </div>
               <div class="w-full bg-gray-200 rounded-full h-2.5">
                   <div class="bg-indigo-600 h-2.5 rounded-full" style="width: ${percentage}%"></div>
               </div>
               <div class="mt-1 text-xs text-gray-500 text-right">${percentage.toFixed(1)}% of total</div>
           `;
           
           topSaversList.appendChild(saverItem);
       });
   }
   
   // Create a new community wallet
   function createCommunityWallet() {
       const nameInput = document.getElementById('communityName');
       const descriptionInput = document.getElementById('communityDescription');
       const rulesInput = document.getElementById('communityRules');
       const isPublicInput = document.getElementById('isPublic');
       const initialAmountInput = document.getElementById('initialAmount');
       
       const name = nameInput.value.trim();
       const description = descriptionInput.value.trim();
       const rules = rulesInput.value.trim();
       const isPublic = isPublicInput.checked;
       const initialAmount = parseFloat(initialAmountInput.value) || 0;
       
       if (!name) {
           nameInput.classList.add('is-invalid');
           return;
       }
       
       try {
           // Create metadata
           const metadata = {
               publicInfo: {
                   description,
                   rules,
                   isPublic
               },
               members: []
           };
           
           // Create the wallet
           const wallet = communityService.createCommunitySavingsWallet(name, initialAmount, metadata);
           
           // Hide the modal
           $('#createCommunityModal').modal('hide');
           
           // Reset form
           nameInput.value = '';
           descriptionInput.value = '';
           rulesInput.value = '';
           isPublicInput.checked = true;
           initialAmountInput.value = '';
           
           // Show success notification
           showNotification(true, 'Success', `Community "${name}" created successfully.`);
           
           // Reload communities
           loadCommunities();
           
       } catch (error) {
           console.error('Error creating community:', error);
           showNotification(false, 'Error', 'Failed to create community. Please try again.');
       }
   }
   
   // Fund a community wallet
   function fundCommunityWallet() {
       const amountInput = document.getElementById('fundAmount');
       const nameInput = document.getElementById('contributorName');
       const noteInput = document.getElementById('contributionNote');
       
       const amount = parseFloat(amountInput.value);
       const name = nameInput.value.trim();
       const note = noteInput.value.trim();
       
       if (!amount || amount <= 0) {
           amountInput.classList.add('is-invalid');
           return;
       }
       
       if (!name) {
           nameInput.classList.add('is-invalid');
           return;
       }
       
       const walletId = document.getElementById('fundCommunityWalletId').value;
       
       try {
           // Create contributor info
           const contributorInfo = {
               name,
               note
           };
           
           // Fund the wallet
           communityService.fundCommunitySavingsWallet(walletId, amount, contributorInfo);
           
           // Hide the modal
           $('#fundCommunityModal').modal('hide');
           
           // Reset form
           amountInput.value = '';
           nameInput.value = '';
           noteInput.value = '';
           
           // Show success notification
           showNotification(true, 'Success', `Contributed ${formatCurrency(amount)} to ${currentWallet.name}.`);
           
           // If details modal is open, update it
           if ($('#viewCommunityModal').hasClass('show')) {
               viewCommunityDetails(walletId);
           } else {
               // Otherwise just reload communities
               loadCommunities();
           }
           
       } catch (error) {
           console.error('Error funding community:', error);
           showNotification(false, 'Error', 'Failed to process contribution. Please try again.');
       }
   }
   
   // Withdraw from a community wallet
   function withdrawFromCommunityWallet() {
       const amountInput = document.getElementById('withdrawAmount');
       const nameInput = document.getElementById('withdrawerName');
       const reasonInput = document.getElementById('withdrawalReason');
       
       const amount = parseFloat(amountInput.value);
       const name = nameInput.value.trim();
       const reason = reasonInput.value.trim();
       
       if (!amount || amount <= 0) {
           amountInput.classList.add('is-invalid');
           return;
       }
       
       if (!name) {
           nameInput.classList.add('is-invalid');
           return;
       }
       
       if (!reason) {
           reasonInput.classList.add('is-invalid');
           return;
       }
       
       const walletId = document.getElementById('withdrawCommunityWalletId').value;
       const wallet = communityService.walletEngine.getWallet(walletId);
       
       if (amount > wallet.balance) {
           showNotification(false, 'Error', 'Insufficient funds in this community wallet.');
           return;
       }
       
       try {
           // Create withdrawal info
           const withdrawalInfo = {
               name,
               reason
           };
           
           // Withdraw from the wallet
           communityService.withdrawFromCommunitySavingsWallet(walletId, amount, withdrawalInfo);
           
           // Hide the modal
           $('#withdrawCommunityModal').modal('hide');
           
           // Reset form
           amountInput.value = '';
           nameInput.value = '';
           reasonInput.value = '';
           
           // Show success notification
           showNotification(true, 'Success', `Withdrew ${formatCurrency(amount)} from ${wallet.name}.`);
           
           // If details modal is open, update it
           if ($('#viewCommunityModal').hasClass('show')) {
               viewCommunityDetails(walletId);
           } else {
               // Otherwise just reload communities
               loadCommunities();
           }
           
       } catch (error) {
           console.error('Error withdrawing from community:', error);
           
           if (error.message === 'Insufficient funds') {
               showNotification(false, 'Error', 'Insufficient funds in this community wallet.');
           } else {
               showNotification(false, 'Error', 'Failed to withdraw funds. Please try again.');
           }
       }
   }
   
   // Add a member to a community
   function addMemberToCommunity() {
       const nameInput = document.getElementById('memberName');
       const emailInput = document.getElementById('memberEmail');
       const phoneInput = document.getElementById('memberPhone');
       const roleInput = document.getElementById('memberRole');
       
       const name = nameInput.value.trim();
       const email = emailInput.value.trim();
       const phone = phoneInput.value.trim();
       const role = roleInput.value;
       
       if (!name) {
           nameInput.classList.add('is-invalid');
           return;
       }
       
       const walletId = document.getElementById('memberCommunityWalletId').value;
       
       try {
           // Create member info
           const memberInfo = {
               name,
               email: email || undefined,
               phone: phone || undefined,
               role
           };
           
           // Add member to the community
           communityService.addCommunityMember(walletId, memberInfo);
           
           // Hide the modal
           $('#addMemberModal').modal('hide');
           
           // Reset form
           nameInput.value = '';
           emailInput.value = '';
           phoneInput.value = '';
           roleInput.value = 'member';
           
           // Show success notification
           showNotification(true, 'Success', `${name} added to ${currentWallet.name}.`);
           
           // Update members tab if view modal is open
           if ($('#viewCommunityModal').hasClass('show')) {
               // Get the latest wallet data
               currentWallet = communityService.walletEngine.getWallet(walletId);
               populateMembersTab(currentWallet);
               
               // Update member count
               const memberCount = currentWallet.metadata && 
                                  currentWallet.metadata.members ? 
                                  currentWallet.metadata.members.length : 0;
               document.getElementById('viewCommunityMemberCount').textContent = memberCount;
           } else {
               // Otherwise just reload communities
               loadCommunities();
           }
           
       } catch (error) {
           console.error('Error adding member:', error);
           showNotification(false, 'Error', 'Failed to add member. Please try again.');
       }
   }
   
   // Display notification
   function showNotification(isSuccess, title, message) {
       const toast = document.getElementById('notificationToast');
       const iconContainer = document.getElementById('notificationIcon');
       const titleElement = document.getElementById('notificationTitle');
       const messageElement = document.getElementById('notificationMessage');
       
       // Set the content
       titleElement.textContent = title;
       messageElement.textContent = message;
       
       // Set the appropriate icon and colors
       if (isSuccess) {
           iconContainer.className = 'flex-shrink-0 w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3';
           iconContainer.innerHTML = `
               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
               </svg>
           `;
       } else {
           iconContainer.className = 'flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3';
           iconContainer.innerHTML = `
               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
               </svg>
           `;
       }
       
       // Show the notification
       toast.classList.remove('translate-y-[-100px]', 'opacity-0');
       toast.classList.add('translate-y-0', 'opacity-100');
       
       // Hide after 3 seconds
       setTimeout(() => {
           toast.classList.remove('translate-y-0', 'opacity-100');
           toast.classList.add('translate-y-[-100px]', 'opacity-0');
       }, 3000);
   }
   
   // Event Listeners
   
   // Create Community Button
   createCommunityBtn.addEventListener('click', () => {
       $('#createCommunityModal').modal('show');
   });
   
   // Create First Community Button
   createFirstCommunityBtn.addEventListener('click', () => {
       $('#createCommunityModal').modal('show');
   });
   
   // Save New Community Button
   document.getElementById('saveNewCommunityBtn').addEventListener('click', createCommunityWallet);
   
   // Tab switching
   document.querySelectorAll('.community-tab-link').forEach(link => {
       link.addEventListener('click', (e) => {
           e.preventDefault();
           const tabName = link.getAttribute('data-tab');
           switchTab(tabName);
       });
   });
   
   // Fund Community Button
   document.getElementById('fundCommunityBtn').addEventListener('click', () => {
       document.getElementById('fundCommunityWalletId').value = currentWallet.id;
       document.getElementById('fundCommunityTitle').textContent = `Contribute to ${currentWallet.name}`;
       
       // Hide view modal and show fund modal
       $('#viewCommunityModal').modal('hide');
       $('#fundCommunityModal').modal('show');
   });
   
   // Withdraw Community Button
   document.getElementById('withdrawCommunityBtn').addEventListener('click', () => {
       document.getElementById('withdrawCommunityWalletId').value = currentWallet.id;
       document.getElementById('withdrawCommunityTitle').textContent = `Withdraw from ${currentWallet.name}`;
       document.getElementById('availableBalance').textContent = formatCurrency(currentWallet.balance);
       
       // Hide view modal and show withdraw modal
       $('#viewCommunityModal').modal('hide');
       $('#withdrawCommunityModal').modal('show');
   });
   
   // Add Member Button
   document.getElementById('addMemberBtn').addEventListener('click', () => {
       document.getElementById('memberCommunityWalletId').value = currentWallet.id;
       document.getElementById('addMemberTitle').textContent = `Add New Member to ${currentWallet.name}`;
       
       // Hide view modal and show add member modal
       $('#viewCommunityModal').modal('hide');
       $('#addMemberModal').modal('show');
   });
   
   // Confirm Fund Button
   document.getElementById('confirmFundBtn').addEventListener('click', fundCommunityWallet);
   
   // Confirm Withdraw Button
   document.getElementById('confirmWithdrawBtn').addEventListener('click', withdrawFromCommunityWallet);
   
   // Save Member Button
   document.getElementById('saveMemberBtn').addEventListener('click', addMemberToCommunity);
   
   // Input validation resets
   document.getElementById('communityName').addEventListener('input', function() {
       this.classList.remove('is-invalid');
   });
   
   document.getElementById('fundAmount').addEventListener('input', function() {
       this.classList.remove('is-invalid');
   });
   
   document.getElementById('contributorName').addEventListener('input', function() {
       this.classList.remove('is-invalid');
   });
   
   document.getElementById('withdrawAmount').addEventListener('input', function() {
       this.classList.remove('is-invalid');
   });
   
   document.getElementById('withdrawerName').addEventListener('input', function() {
       this.classList.remove('is-invalid');
   });
   
   document.getElementById('withdrawalReason').addEventListener('input', function() {
       this.classList.remove('is-invalid');
   });
   
   document.getElementById('memberName').addEventListener('input', function() {
       this.classList.remove('is-invalid');
   });
   
   // Mobile Menu
   document.getElementById('mobileMoreBtn').addEventListener('click', function() {
       document.getElementById('mobileMoreMenu').classList.toggle('hidden');
   });
   
   // Close mobile menu when clicking outside
   document.addEventListener('click', function(event) {
       const mobileMenu = document.getElementById('mobileMoreMenu');
       const mobileBtn = document.getElementById('mobileMoreBtn');
       
       if (!mobileBtn.contains(event.target) && !mobileMenu.contains(event.target)) {
           mobileMenu.classList.add('hidden');
       }
   });
   
   // Start the loading simulation
   simulateLoading();
});
</script>

    </main>
    <!-- JavaScript common -->
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"
      integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"
      integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9"
      crossorigin="anonymous"
    ></script>
    <!-- Page specific-->
    <!-- JavaScript common -->
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js"
      integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js"
      integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9"
      crossorigin="anonymous"
    ></script>
    <script>
      class WalletEngine {
        constructor() {
          // Initialize storage if not already initialized
          if (!localStorage.getItem("wallets")) {
            localStorage.setItem("wallets", JSON.stringify([]));
          }

          if (!localStorage.getItem("transactions")) {
            localStorage.setItem("transactions", JSON.stringify([]));
          }
        }

        /**
         * Generate a unique ID
         * @returns {string} Unique ID
         */
        generateId() {
          return (
            Date.now().toString(36) + Math.random().toString(36).substr(2, 5)
          );
        }

        /**
         * Get all wallets for an account
         * @param {string} accountId - Account ID
         * @param {string} walletType - Optional wallet type filter
         * @returns {Array} Array of wallets
         */
        getWallets(accountId, walletType = null) {
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          return wallets.filter((wallet) => {
            if (wallet.accountId !== accountId) return false;
            if (walletType && wallet.walletType !== walletType) return false;
            return true;
          });
        }

        /**
         * Create a new wallet
         * @param {string} accountId - Account ID
         * @param {string} walletType - Type of wallet
         * @param {string} name - Wallet name
         * @param {Object} metadata - Additional metadata
         * @returns {Object} Created wallet
         */
        createWallet(accountId, walletType, name, metadata = {}) {
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");

          const newWallet = {
            id: this.generateId(),
            accountId,
            walletType,
            name,
            balance: 0,
            createdAt: new Date().toISOString(),
            metadata,
          };

          wallets.push(newWallet);
          localStorage.setItem("wallets", JSON.stringify(wallets));

          return newWallet;
        }

        /**
         * Get a specific wallet by ID
         * @param {string} walletId - Wallet ID
         * @returns {Object|null} Wallet object or null if not found
         */
        getWallet(walletId) {
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          return wallets.find((wallet) => wallet.id === walletId) || null;
        }

        /**
         * Sum the balances of multiple wallets
         * @param {Array} wallets - Array of wallet objects
         * @returns {number} Total balance
         */
        sumWallets(wallets) {
          return wallets.reduce((total, wallet) => total + wallet.balance, 0);
        }

        /**
         * Sum the balances of all wallets of a specific type
         * @param {string} walletType - Type of wallets to sum
         * @returns {Object} Object containing total balance and count of wallets
         */
        sumWalletTypes(walletType) {
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          const filteredWallets = wallets.filter(
            (wallet) => wallet.walletType === walletType
          );

          return {
            balance: this.sumWallets(filteredWallets),
            count: filteredWallets.length,
          };
        }

        /**
         * Add funds to a wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to add
         * @returns {Object} Updated wallet
         */
        fundWallet(walletId, amount) {
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          const transactions = JSON.parse(
            localStorage.getItem("transactions") || "[]"
          );

          const walletIndex = wallets.findIndex(
            (wallet) => wallet.id === walletId
          );
          if (walletIndex === -1) {
            throw new Error(`Wallet with ID ${walletId} not found`);
          }

          // Update wallet balance
          wallets[walletIndex].balance += amount;
          localStorage.setItem("wallets", JSON.stringify(wallets));

          // Create transaction record
          const transaction = {
            id: this.generateId(),
            walletId,
            type: "credit",
            amount,
            balance: wallets[walletIndex].balance,
            timestamp: new Date().toISOString(),
            description: `Funded wallet ${wallets[walletIndex].name}`,
          };

          transactions.push(transaction);
          localStorage.setItem("transactions", JSON.stringify(transactions));

          return wallets[walletIndex];
        }

        /**
         * Remove funds from a wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to debit
         * @returns {Object} Updated wallet
         */
        debitWallet(walletId, amount) {
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          const transactions = JSON.parse(
            localStorage.getItem("transactions") || "[]"
          );

          const walletIndex = wallets.findIndex(
            (wallet) => wallet.id === walletId
          );
          if (walletIndex === -1) {
            throw new Error(`Wallet with ID ${walletId} not found`);
          }

          if (wallets[walletIndex].balance < amount) {
            throw new Error("Insufficient funds");
          }

          // Update wallet balance
          wallets[walletIndex].balance -= amount;
          localStorage.setItem("wallets", JSON.stringify(wallets));

          // Create transaction record
          const transaction = {
            id: this.generateId(),
            walletId,
            type: "debit",
            amount,
            balance: wallets[walletIndex].balance,
            timestamp: new Date().toISOString(),
            description: `Debited from wallet ${wallets[walletIndex].name}`,
          };

          transactions.push(transaction);
          localStorage.setItem("transactions", JSON.stringify(transactions));

          return wallets[walletIndex];
        }

        /**
         * Get all transactions for a wallet
         * @param {string} walletId - Wallet ID
         * @returns {Array} Array of transactions
         */
        getWalletTransactions(walletId) {
          const transactions = JSON.parse(
            localStorage.getItem("transactions") || "[]"
          );
          return transactions.filter(
            (transaction) => transaction.walletId === walletId
          );
        }

        /**
         * Move funds from one wallet to another
         * @param {string} sourceWalletId - Source wallet ID
         * @param {string} destinationWalletId - Destination wallet ID
         * @param {number} amount - Amount to transfer
         * @returns {Object} Object containing updated source and destination wallets
         */
        moveFund(sourceWalletId, destinationWalletId, amount) {
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");

          const sourceWalletIndex = wallets.findIndex(
            (wallet) => wallet.id === sourceWalletId
          );
          if (sourceWalletIndex === -1) {
            throw new Error(
              `Source wallet with ID ${sourceWalletId} not found`
            );
          }

          const destWalletIndex = wallets.findIndex(
            (wallet) => wallet.id === destinationWalletId
          );
          if (destWalletIndex === -1) {
            throw new Error(
              `Destination wallet with ID ${destinationWalletId} not found`
            );
          }

          if (wallets[sourceWalletIndex].balance < amount) {
            throw new Error("Insufficient funds in source wallet");
          }

          // Debit source wallet
          this.debitWallet(sourceWalletId, amount);

          // Credit destination wallet
          this.fundWallet(destinationWalletId, amount);

          // Get updated wallets
          const updatedWallets = JSON.parse(
            localStorage.getItem("wallets") || "[]"
          );
          const sourceWallet = updatedWallets.find(
            (wallet) => wallet.id === sourceWalletId
          );
          const destWallet = updatedWallets.find(
            (wallet) => wallet.id === destinationWalletId
          );

          return {
            sourceWallet,
            destinationWallet: destWallet,
          };
        }

        /**
         * Clear all data (for testing purposes)
         */
        clearAll() {
          localStorage.removeItem("wallets");
          localStorage.removeItem("transactions");
          localStorage.setItem("wallets", JSON.stringify([]));
          localStorage.setItem("transactions", JSON.stringify([]));
        }
      }

      // Export as global variable
      window.WalletEngine = WalletEngine;
    </script>
    <script>
      class SavingsService {
        constructor(accountId) {
          this.walletEngine = new WalletEngine();
          this.accountId = accountId;
          this.walletType = "savings";
        }

        /**
         * Get total savings amount across all savings wallets
         * @returns {number} Total savings amount
         */
        getTotalSavings() {
          const result = this.walletEngine.sumWalletTypes(this.walletType);
          return result.balance;
        }

        /**
         * Get all savings wallets
         * @returns {Array} Array of savings wallets
         */
        getSavingsWallets() {
          return this.walletEngine.getWallets(this.accountId, this.walletType);
        }

        /**
         * Create a new savings wallet
         * @param {string} name - Wallet name
         * @param {number} initialBalance - Optional initial balance
         * @returns {Object} Created wallet
         */
        createSavingsWallet(name, initialBalance = 0) {
          const wallet = this.walletEngine.createWallet(
            this.accountId,
            this.walletType,
            name
          );

          // Fund the wallet if initial balance is provided
          if (initialBalance > 0) {
            this.walletEngine.fundWallet(wallet.id, initialBalance);
            return this.walletEngine.getWallet(wallet.id); // Get updated wallet with balance
          }

          return wallet;
        }

        /**
         * Fund a savings wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to add
         * @returns {Object} Updated wallet
         */
        fundSavingsWallet(walletId, amount) {
          // Verify this is a savings wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid savings wallet");
          }

          return this.walletEngine.fundWallet(walletId, amount);
        }

        /**
         * Withdraw from a savings wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to withdraw
         * @returns {Object} Updated wallet
         */
        withdrawFromSavingsWallet(walletId, amount) {
          // Verify this is a savings wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid savings wallet");
          }

          return this.walletEngine.debitWallet(walletId, amount);
        }

        /**
         * Get transactions for a savings wallet
         * @param {string} walletId - Wallet ID
         * @returns {Array} Array of transactions
         */
        getSavingsTransactions(walletId) {
          // Verify this is a savings wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid savings wallet");
          }

          return this.walletEngine.getWalletTransactions(walletId);
        }
      }

      /**
       * CommunityService - Manages community savings wallets
       * Built on top of WalletEngine with public viewing capabilities
       */
      class CommunityService {
        constructor(accountId) {
          this.walletEngine = new WalletEngine();
          this.accountId = accountId;
          this.walletType = "community";
        }

        /**
         * Get total community savings amount across all community wallets
         * @returns {number} Total community savings amount
         */
        getTotalCommunitySavings() {
          const result = this.walletEngine.sumWalletTypes(this.walletType);
          return result.balance;
        }

        /**
         * Get all community savings wallets
         * @param {boolean} publicView - If true, returns public information only
         * @returns {Array} Array of community wallets
         */
        getCommunitySavingsWallets(publicView = false) {
          const wallets = this.walletEngine.getWallets(
            this.accountId,
            this.walletType
          );

          if (publicView) {
            // For public view, filter out sensitive information
            return wallets.map((wallet) => {
              return {
                id: wallet.id,
                name: wallet.name,
                balance: wallet.balance,
                createdAt: wallet.createdAt,
                publicInfo: wallet.metadata.publicInfo || {},
                memberCount: wallet.metadata.members?.length || 0,
              };
            });
          }

          return wallets;
        }

        /**
         * Create a new community savings wallet
         * @param {string} name - Wallet name
         * @param {number} initialBalance - Optional initial balance
         * @param {Object} metadata - Additional metadata like community details, rules, members
         * @returns {Object} Created wallet
         */
        createCommunitySavingsWallet(name, initialBalance = 0, metadata = {}) {
          // Ensure metadata has a publicInfo field for public viewing
          const enhancedMetadata = {
            ...metadata,
            publicInfo: metadata.publicInfo || {
              description: "",
              rules: "",
              isPublic: true,
            },
          };

          const wallet = this.walletEngine.createWallet(
            this.accountId,
            this.walletType,
            name,
            enhancedMetadata
          );

          // Fund the wallet if initial balance is provided
          if (initialBalance > 0) {
            this.walletEngine.fundWallet(wallet.id, initialBalance);
            return this.walletEngine.getWallet(wallet.id); // Get updated wallet with balance
          }

          return wallet;
        }

        /**
         * Fund a community savings wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to add
         * @param {Object} contributorInfo - Information about the contributor
         * @returns {Object} Updated wallet
         */
        fundCommunitySavingsWallet(walletId, amount, contributorInfo = {}) {
          // Verify this is a community wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid community wallet");
          }

          // Add contributor info to wallet metadata
          const updatedWallet = this.walletEngine.getWallet(walletId);
          updatedWallet.metadata.contributions =
            updatedWallet.metadata.contributions || [];
          updatedWallet.metadata.contributions.push({
            ...contributorInfo,
            amount,
            timestamp: new Date().toISOString(),
          });

          // Update wallet with new metadata
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          const walletIndex = wallets.findIndex((w) => w.id === walletId);
          if (walletIndex !== -1) {
            wallets[walletIndex] = updatedWallet;
            localStorage.setItem("wallets", JSON.stringify(wallets));
          }

          return this.walletEngine.fundWallet(walletId, amount);
        }

        /**
         * Withdraw from a community savings wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to withdraw
         * @param {Object} withdrawalInfo - Information about the withdrawal
         * @returns {Object} Updated wallet
         */
        withdrawFromCommunitySavingsWallet(
          walletId,
          amount,
          withdrawalInfo = {}
        ) {
          // Verify this is a community wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid community wallet");
          }

          // Add withdrawal info to wallet metadata
          const updatedWallet = this.walletEngine.getWallet(walletId);
          updatedWallet.metadata.withdrawals =
            updatedWallet.metadata.withdrawals || [];
          updatedWallet.metadata.withdrawals.push({
            ...withdrawalInfo,
            amount,
            timestamp: new Date().toISOString(),
          });

          // Update wallet with new metadata
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          const walletIndex = wallets.findIndex((w) => w.id === walletId);
          if (walletIndex !== -1) {
            wallets[walletIndex] = updatedWallet;
            localStorage.setItem("wallets", JSON.stringify(wallets));
          }

          return this.walletEngine.debitWallet(walletId, amount);
        }

        /**
         * Get transactions for a community savings wallet
         * @param {string} walletId - Wallet ID
         * @param {boolean} publicView - If true, returns public information only
         * @returns {Array} Array of transactions
         */
        getCommunitySavingsTransactions(walletId, publicView = false) {
          // Get the wallet
          const wallet = this.walletEngine.getWallet(walletId);
          if (!wallet || wallet.walletType !== this.walletType) {
            throw new Error("Invalid community wallet");
          }

          // For public view, only show if wallet is marked as public
          if (publicView && !wallet.metadata.publicInfo?.isPublic) {
            throw new Error("This community wallet is not public");
          }

          const transactions =
            this.walletEngine.getWalletTransactions(walletId);

          if (publicView) {
            // For public view, filter out sensitive information
            return transactions.map((tx) => {
              return {
                id: tx.id,
                type: tx.type,
                amount: tx.amount,
                timestamp: tx.timestamp,
                description: tx.description,
              };
            });
          }

          return transactions;
        }

        /**
         * Add a member to a community savings wallet
         * @param {string} walletId - Wallet ID
         * @param {Object} memberInfo - Information about the member
         * @returns {Object} Updated wallet
         */
        addCommunityMember(walletId, memberInfo) {
          // Verify this is a community wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid community wallet");
          }

          // Add member to wallet metadata
          const updatedWallet = this.walletEngine.getWallet(walletId);
          updatedWallet.metadata.members = updatedWallet.metadata.members || [];
          updatedWallet.metadata.members.push({
            ...memberInfo,
            joinedAt: new Date().toISOString(),
          });

          // Update wallet with new metadata
          const wallets = JSON.parse(localStorage.getItem("wallets") || "[]");
          const walletIndex = wallets.findIndex((w) => w.id === walletId);
          if (walletIndex !== -1) {
            wallets[walletIndex] = updatedWallet;
            localStorage.setItem("wallets", JSON.stringify(wallets));
          }

          return updatedWallet;
        }

        /**
         * Get public information about all community savings wallets
         * This method can be called without an account ID
         * @returns {Array} Array of public community wallet information
         */
        static getPublicCommunityWallets() {
          const walletEngine = new WalletEngine();
          const allWallets = JSON.parse(
            localStorage.getItem("wallets") || "[]"
          );

          return allWallets
            .filter(
              (wallet) =>
                wallet.walletType === "community" &&
                wallet.metadata.publicInfo?.isPublic
            )
            .map((wallet) => {
              return {
                id: wallet.id,
                name: wallet.name,
                balance: wallet.balance,
                createdAt: wallet.createdAt,
                publicInfo: wallet.metadata.publicInfo || {},
                memberCount: wallet.metadata.members?.length || 0,
              };
            });
        }
      }

      window.SavingsService = SavingsService;
      window.CommunityService = CommunityService;
    </script>
    <script>
      class DonationService {
        constructor(accountId) {
          this.walletEngine = new WalletEngine();
          this.accountId = accountId;
          this.walletType = "donation";
        }

        /**
         * Get total donations amount across all donation wallets
         * @returns {number} Total donations amount
         */
        getTotalDonations() {
          const result = this.walletEngine.sumWalletTypes(this.walletType);
          return result.balance;
        }

        /**
         * Get all donation wallets
         * @returns {Array} Array of donation wallets
         */
        getDonationWallets() {
          return this.walletEngine.getWallets(this.accountId, this.walletType);
        }

        /**
         * Create a new donation wallet
         * @param {string} name - Wallet name
         * @param {number} initialBalance - Optional initial balance
         * @param {Object} metadata - Additional metadata like purpose, target, etc.
         * @returns {Object} Created wallet
         */
        createDonationWallet(name, initialBalance = 0, metadata = {}) {
          const wallet = this.walletEngine.createWallet(
            this.accountId,
            this.walletType,
            name,
            metadata
          );

          // Fund the wallet if initial balance is provided
          if (initialBalance > 0) {
            this.walletEngine.fundWallet(wallet.id, initialBalance);
            return this.walletEngine.getWallet(wallet.id); // Get updated wallet with balance
          }

          return wallet;
        }

        /**
         * Fund a donation wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to add
         * @returns {Object} Updated wallet
         */
        fundDonationWallet(walletId, amount) {
          // Verify this is a donation wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid donation wallet");
          }

          return this.walletEngine.fundWallet(walletId, amount);
        }

        /**
         * Withdraw from a donation wallet
         * @param {string} walletId - Wallet ID
         * @param {number} amount - Amount to withdraw
         * @returns {Object} Updated wallet
         */
        withdrawFromDonationWallet(walletId, amount) {
          // Verify this is a donation wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid donation wallet");
          }

          return this.walletEngine.debitWallet(walletId, amount);
        }

        /**
         * Get transactions for a donation wallet
         * @param {string} walletId - Wallet ID
         * @returns {Array} Array of transactions
         */
        getDonationWalletTransactions(walletId) {
          // Verify this is a donation wallet belonging to this account
          const wallet = this.walletEngine.getWallet(walletId);
          if (
            !wallet ||
            wallet.walletType !== this.walletType ||
            wallet.accountId !== this.accountId
          ) {
            throw new Error("Invalid donation wallet");
          }

          return this.walletEngine.getWalletTransactions(walletId);
        }
      }

      window.DonationService = DonationService;
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const moreBtn = document.getElementById("mobileMoreBtn");
        const moreMenu = document.getElementById("mobileMoreMenu");

        if (moreBtn && moreMenu) {
          moreBtn.addEventListener("click", function () {
            moreMenu.classList.toggle("hidden");
          });

          // Close menu when clicking outside
          document.addEventListener("click", function (event) {
            if (
              !moreBtn.contains(event.target) &&
              !moreMenu.contains(event.target)
            ) {
              moreMenu.classList.add("hidden");
            }
          });
        }
      });
    </script>
  </body>
</html>
